
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
   <head>
      <meta charset="UTF-8"/>
      <title>SpotBugs Report</title>
      <style type="text/css">
		.tablerow0 {
			background: #EEEEEE;
		}

		.tablerow1 {
			background: white;
		}

		.detailrow0 {
			background: #EEEEEE;
		}

		.detailrow1 {
			background: white;
		}

		.tableheader {
			background: #b9b9fe;
			font-size: larger;
		}
		</style>
   </head>
   <body>
      <h1>SpotBugs Report</h1>
      <p>Produced using <a href="https://spotbugs.github.io">SpotBugs</a>4.4.2.</p>
      <p>Project: 
			AmazeFileManager-3.8.4[AmazeFileManager-3.8.4.file_operations.main]</p>
      <h2>Metrics</h2>
      <p>1208 lines of code analyzed,
	in 25 classes, 
	in 9 packages.</p>
      <table width="500" cellpadding="5" cellspacing="2">
         <tr class="tableheader">
            <th align="left">Metric</th>
            <th align="right">Total</th>
            <th align="right">Density*</th>
         </tr>
         <tr class="tablerow0">
            <td>High Priority Warnings</td>
            <td align="right"/>
            <td align="right">NaN</td>
         </tr>
         <tr class="tablerow1">
            <td>Medium Priority Warnings</td>
            <td align="right">10</td>
            <td align="right">8.28</td>
         </tr>
         <tr class="$totalClass">
            <td>
               <b>Total Warnings</b>
            </td>
            <td align="right">
               <b>10</b>
            </td>
            <td align="right">
               <b>8.28</b>
            </td>
         </tr>
      </table>
      <p>
         <i>(* Defects per Thousand lines of non-commenting source statements)</i>
      </p>
      <p>
         <br/>
         <br/>
      </p>
      <h2>Summary</h2>
      <table width="500" cellpadding="5" cellspacing="2">
         <tr class="tableheader">
            <th align="left">Warning Type</th>
            <th align="right">Number</th>
         </tr>
         <tr class="tablerow0">
            <td>
               <a href="#Warnings_SECURITY">Security Warnings</a>
            </td>
            <td align="right">10</td>
         </tr>
         <tr class="tablerow1">
            <td>
               <b>Total</b>
            </td>
            <td align="right">
               <b>10</b>
            </td>
         </tr>
      </table>
      <p>
         <br/>
         <br/>
      </p>
      <h1>Warnings</h1>
      <p>Click on each warning link to see a full description of the issue, and
	    details of how to resolve it.</p>
      <h2>
         <a name="Warnings_SECURITY">Security Warnings</a>
      </h2>
      <table class="warningtable"
             width="100%"
             cellspacing="2"
             cellpadding="5">
         <tr class="tableheader">
            <th align="left">Warning</th>
            <th align="left">Priority</th>
            <th align="left">Details</th>
         </tr>
         <tr class="tablerow1">
            <td width="20%" valign="top">
               <a href="#CRLF_INJECTION_LOGS">Potential CRLF Injection for logs</a>
            </td>
            <td width="10%" valign="top">Medium</td>
            <td width="70%">
               <p>This use of org/slf4j/Logger.debug(Ljava/lang/String;)V might be used to include CRLF characters into log messages<br/>
                  <br/>
                  <br/>In file CloudStreamServer.java CloudStreamServer.java CloudStreamServer.java CloudStreamServer.java CloudStreamServer.java CloudStreamServer.java CloudStreamServer.java,
					
						line 359 359 492 494 499 500 529<br/>In class com.amaze.filemanager.fileoperations.filesystem.cloud.CloudStreamServer$HTTPSession<br/>In method com.amaze.filemanager.fileoperations.filesystem.cloud.CloudStreamServer$HTTPSession.handleResponse(Socket)<br/>At CloudStreamServer.java:[line 359]<br/>Sink method org/slf4j/Logger.debug(Ljava/lang/String;)V<br/>Sink parameter 0<br/>Tainted source java/io/BufferedReader.readLine()Ljava/lang/String;<br/>Tainted source java/util/Properties.toString()Ljava/lang/String;<br/>Tainted source java/util/StringTokenizer.nextToken()Ljava/lang/String;<br/>Tainted source java/util/Properties.put(Ljava/lang/Object;Ljava/lang/Object;)Ljava/lang/Object;<br/>Unknown source com/amaze/filemanager/fileoperations/filesystem/cloud/CloudStreamServer$HTTPSession.decodeHeader(Ljava/io/BufferedReader;Ljava/util/Properties;Ljava/util/Properties;Ljava/util/Properties;)V parameter 2<br/>Tainted source java/util/StringTokenizer.&lt;init&gt;(Ljava/lang/String;)V<br/>Unknown source android/net/Uri.decode(Ljava/lang/String;)Ljava/lang/String;<br/>At CloudStreamServer.java:[line 359]<br/>At CloudStreamServer.java:[line 492]<br/>At CloudStreamServer.java:[line 494]<br/>At CloudStreamServer.java:[line 499]<br/>At CloudStreamServer.java:[line 500]<br/>At CloudStreamServer.java:[line 529]</p>
            </td>
         </tr>
         <tr class="tablerow0">
            <td width="20%" valign="top">
               <a href="#CRLF_INJECTION_LOGS">Potential CRLF Injection for logs</a>
            </td>
            <td width="10%" valign="top">Medium</td>
            <td width="70%">
               <p>This use of org/slf4j/Logger.debug(Ljava/lang/String;)V might be used to include CRLF characters into log messages<br/>
                  <br/>
                  <br/>In file CloudStreamServer.java CloudStreamServer.java CloudStreamServer.java CloudStreamServer.java CloudStreamServer.java,
					
						line 361 361 520 524 525<br/>In class com.amaze.filemanager.fileoperations.filesystem.cloud.CloudStreamServer$HTTPSession<br/>In method com.amaze.filemanager.fileoperations.filesystem.cloud.CloudStreamServer$HTTPSession.handleResponse(Socket)<br/>At CloudStreamServer.java:[line 361]<br/>Sink method org/slf4j/Logger.debug(Ljava/lang/String;)V<br/>Sink parameter 0<br/>Tainted source java/io/BufferedReader.readLine()Ljava/lang/String;<br/>Tainted source java/util/Properties.toString()Ljava/lang/String;<br/>Unknown source com/amaze/filemanager/fileoperations/filesystem/cloud/CloudStreamServer$HTTPSession.decodeHeader(Ljava/io/BufferedReader;Ljava/util/Properties;Ljava/util/Properties;Ljava/util/Properties;)V parameter 0<br/>Tainted source java/util/Properties.put(Ljava/lang/Object;Ljava/lang/Object;)Ljava/lang/Object;<br/>At CloudStreamServer.java:[line 361]<br/>At CloudStreamServer.java:[line 520]<br/>At CloudStreamServer.java:[line 524]<br/>At CloudStreamServer.java:[line 525]</p>
            </td>
         </tr>
         <tr class="tablerow1">
            <td width="20%" valign="top">
               <a href="#CRLF_INJECTION_LOGS">Potential CRLF Injection for logs</a>
            </td>
            <td width="10%" valign="top">Medium</td>
            <td width="70%">
               <p>This use of org/slf4j/Logger.debug(Ljava/lang/String;)V might be used to include CRLF characters into log messages<br/>
                  <br/>
                  <br/>In file StreamServer.java StreamServer.java StreamServer.java StreamServer.java StreamServer.java StreamServer.java StreamServer.java,
					
						line 268 268 401 403 408 409 438<br/>In class com.amaze.filemanager.fileoperations.filesystem.smbstreamer.StreamServer$HTTPSession<br/>In method com.amaze.filemanager.fileoperations.filesystem.smbstreamer.StreamServer$HTTPSession.handleResponse(Socket)<br/>At StreamServer.java:[line 268]<br/>Sink method org/slf4j/Logger.debug(Ljava/lang/String;)V<br/>Sink parameter 0<br/>Tainted source java/io/BufferedReader.readLine()Ljava/lang/String;<br/>Unknown source com/amaze/filemanager/fileoperations/filesystem/smbstreamer/StreamServer$HTTPSession.decodeHeader(Ljava/io/BufferedReader;Ljava/util/Properties;Ljava/util/Properties;Ljava/util/Properties;)V parameter 2<br/>Tainted source java/util/Properties.toString()Ljava/lang/String;<br/>Tainted source java/util/StringTokenizer.nextToken()Ljava/lang/String;<br/>Tainted source java/util/Properties.put(Ljava/lang/Object;Ljava/lang/Object;)Ljava/lang/Object;<br/>Tainted source java/util/StringTokenizer.&lt;init&gt;(Ljava/lang/String;)V<br/>Unknown source android/net/Uri.decode(Ljava/lang/String;)Ljava/lang/String;<br/>At StreamServer.java:[line 268]<br/>At StreamServer.java:[line 401]<br/>At StreamServer.java:[line 403]<br/>At StreamServer.java:[line 408]<br/>At StreamServer.java:[line 409]<br/>At StreamServer.java:[line 438]</p>
            </td>
         </tr>
         <tr class="tablerow0">
            <td width="20%" valign="top">
               <a href="#CRLF_INJECTION_LOGS">Potential CRLF Injection for logs</a>
            </td>
            <td width="10%" valign="top">Medium</td>
            <td width="70%">
               <p>This use of org/slf4j/Logger.debug(Ljava/lang/String;)V might be used to include CRLF characters into log messages<br/>
                  <br/>
                  <br/>In file StreamServer.java StreamServer.java StreamServer.java StreamServer.java StreamServer.java,
					
						line 270 270 429 433 434<br/>In class com.amaze.filemanager.fileoperations.filesystem.smbstreamer.StreamServer$HTTPSession<br/>In method com.amaze.filemanager.fileoperations.filesystem.smbstreamer.StreamServer$HTTPSession.handleResponse(Socket)<br/>At StreamServer.java:[line 270]<br/>Sink method org/slf4j/Logger.debug(Ljava/lang/String;)V<br/>Sink parameter 0<br/>Tainted source java/io/BufferedReader.readLine()Ljava/lang/String;<br/>Tainted source java/util/Properties.toString()Ljava/lang/String;<br/>Unknown source com/amaze/filemanager/fileoperations/filesystem/smbstreamer/StreamServer$HTTPSession.decodeHeader(Ljava/io/BufferedReader;Ljava/util/Properties;Ljava/util/Properties;Ljava/util/Properties;)V parameter 0<br/>Tainted source java/util/Properties.put(Ljava/lang/Object;Ljava/lang/Object;)Ljava/lang/Object;<br/>At StreamServer.java:[line 270]<br/>At StreamServer.java:[line 429]<br/>At StreamServer.java:[line 433]<br/>At StreamServer.java:[line 434]</p>
            </td>
         </tr>
         <tr class="tablerow1">
            <td width="20%" valign="top">
               <a href="#PATH_TRAVERSAL_IN">Potential Path Traversal (file read)</a>
            </td>
            <td width="10%" valign="top">Medium</td>
            <td width="70%">
               <p>This API (java/io/File.createTempFile(Ljava/lang/String;Ljava/lang/String;Ljava/io/File;)Ljava/io/File;) reads a file whose location might be specified by user input<br/>
                  <br/>
                  <br/>In file CloudStreamServer.java CloudStreamServer.java,
					
						line 646 646<br/>In class com.amaze.filemanager.fileoperations.filesystem.cloud.CloudStreamServer$HTTPSession<br/>In method com.amaze.filemanager.fileoperations.filesystem.cloud.CloudStreamServer$HTTPSession.saveTmpFile(byte[], int, int)<br/>At CloudStreamServer.java:[line 646]<br/>Sink method java/io/File.createTempFile(Ljava/lang/String;Ljava/lang/String;Ljava/io/File;)Ljava/io/File;<br/>Sink parameter 0<br/>Unknown source java/io/File.&lt;init&gt;(Ljava/lang/String;)V<br/>At CloudStreamServer.java:[line 646]</p>
            </td>
         </tr>
         <tr class="tablerow0">
            <td width="20%" valign="top">
               <a href="#PATH_TRAVERSAL_IN">Potential Path Traversal (file read)</a>
            </td>
            <td width="10%" valign="top">Medium</td>
            <td width="70%">
               <p>This API (java/io/File.createTempFile(Ljava/lang/String;Ljava/lang/String;Ljava/io/File;)Ljava/io/File;) reads a file whose location might be specified by user input<br/>
                  <br/>
                  <br/>In file StreamServer.java StreamServer.java,
					
						line 555 555<br/>In class com.amaze.filemanager.fileoperations.filesystem.smbstreamer.StreamServer$HTTPSession<br/>In method com.amaze.filemanager.fileoperations.filesystem.smbstreamer.StreamServer$HTTPSession.saveTmpFile(byte[], int, int)<br/>At StreamServer.java:[line 555]<br/>Sink method java/io/File.createTempFile(Ljava/lang/String;Ljava/lang/String;Ljava/io/File;)Ljava/io/File;<br/>Sink parameter 0<br/>Unknown source java/io/File.&lt;init&gt;(Ljava/lang/String;)V<br/>At StreamServer.java:[line 555]</p>
            </td>
         </tr>
         <tr class="tablerow1">
            <td width="20%" valign="top">
               <a href="#UNENCRYPTED_SERVER_SOCKET">Unencrypted Server Socket</a>
            </td>
            <td width="10%" valign="top">Medium</td>
            <td width="70%">
               <p>Unencrypted server socket (instead of SSLServerSocket)<br/>
                  <br/>
                  <br/>In file CloudStreamServer.java,
					
						line 251<br/>In class com.amaze.filemanager.fileoperations.filesystem.cloud.CloudStreamServer<br/>In method com.amaze.filemanager.fileoperations.filesystem.cloud.CloudStreamServer.tryBind(int)<br/>At CloudStreamServer.java:[line 251]</p>
            </td>
         </tr>
         <tr class="tablerow0">
            <td width="20%" valign="top">
               <a href="#UNENCRYPTED_SERVER_SOCKET">Unencrypted Server Socket</a>
            </td>
            <td width="10%" valign="top">Medium</td>
            <td width="70%">
               <p>Unencrypted server socket (instead of SSLServerSocket)<br/>
                  <br/>
                  <br/>In file CloudStreamServer.java,
					
						line 254<br/>In class com.amaze.filemanager.fileoperations.filesystem.cloud.CloudStreamServer<br/>In method com.amaze.filemanager.fileoperations.filesystem.cloud.CloudStreamServer.tryBind(int)<br/>At CloudStreamServer.java:[line 254]</p>
            </td>
         </tr>
         <tr class="tablerow1">
            <td width="20%" valign="top">
               <a href="#UNENCRYPTED_SERVER_SOCKET">Unencrypted Server Socket</a>
            </td>
            <td width="10%" valign="top">Medium</td>
            <td width="70%">
               <p>Unencrypted server socket (instead of SSLServerSocket)<br/>
                  <br/>
                  <br/>In file StreamServer.java,
					
						line 208<br/>In class com.amaze.filemanager.fileoperations.filesystem.smbstreamer.StreamServer<br/>In method com.amaze.filemanager.fileoperations.filesystem.smbstreamer.StreamServer.tryBind(int)<br/>At StreamServer.java:[line 208]</p>
            </td>
         </tr>
         <tr class="tablerow0">
            <td width="20%" valign="top">
               <a href="#UNENCRYPTED_SERVER_SOCKET">Unencrypted Server Socket</a>
            </td>
            <td width="10%" valign="top">Medium</td>
            <td width="70%">
               <p>Unencrypted server socket (instead of SSLServerSocket)<br/>
                  <br/>
                  <br/>In file StreamServer.java,
					
						line 211<br/>In class com.amaze.filemanager.fileoperations.filesystem.smbstreamer.StreamServer<br/>In method com.amaze.filemanager.fileoperations.filesystem.smbstreamer.StreamServer.tryBind(int)<br/>At StreamServer.java:[line 211]</p>
            </td>
         </tr>
      </table>
      <p>
         <br/>
         <br/>
      </p>
      <p>
         <br/>
         <br/>
      </p>
      <h1>
         <a name="Details">Warning Types</a>
      </h1>
      <h2>
         <a name="CRLF_INJECTION_LOGS">Potential CRLF Injection for logs</a>
      </h2>
            
<p>
    When data from an untrusted source is put into a logger and not neutralized correctly,
    an attacker could forge log entries or include malicious content.
    Inserted false entries could be used to skew statistics, distract the administrator
    or even to implicate another party in the commission of a malicious act.
    If the log file is processed automatically, the attacker can render the file unusable
    by corrupting the format of the file or injecting unexpected characters.
    An attacker may also inject code or other commands into the log file and take advantage
    of a vulnerability in the log processing utility (e.g. command injection or XSS).
</p>
<br/>
<p>
<b>Code at risk:</b><br/>
<pre>String val = request.getParameter("user");
String metadata = request.getParameter("metadata");
[...]
if(authenticated) {
    log.info("User " + val + " (" + metadata + ") was authenticated successfully");
}
else {
    log.info("User " + val + " (" + metadata + ") was not authenticated");
}
</pre>

A malicious user could send the metadata parameter with the value: <code>"Firefox) was authenticated successfully\r\n[INFO] User bbb (Internet Explorer"</code>.
</p>

<b>Solution:</b><br/>
<p>
You can manually sanitize each parameter.
<pre>
log.info("User " + val.replaceAll("[\r\n]","") + " (" + userAgent.replaceAll("[\r\n]","") + ") was not authenticated");
</pre>
</p>

<p>
You can also configure your logger service to replace new line for all message events. Here is sample configuration for LogBack <a href="https://logback.qos.ch/manual/layouts.html#replace">using the <code>replace</code> function</a>.
<pre>
&lt;pattern&gt;%-5level - %replace(%msg){'[\r\n]', ''}%n&lt;/pattern&gt;
</pre>
</p>

<p>
Finally, you can use a logger implementation that replace new line by spaces.
The project <a href="https://github.com/javabeanz/owasp-security-logging">OWASP Security Logging</a> has an implementation for Logback and Log4j.
</p>

<br/>
<p>
    <b>References</b><br/>
    <a href="https://cwe.mitre.org/data/definitions/117.html">CWE-117: Improper Output Neutralization for Logs</a><br/>
    <a href="https://cwe.mitre.org/data/definitions/93.html">CWE-93: Improper Neutralization of CRLF Sequences ('CRLF Injection')</a><br/>
    <a href="https://logback.qos.ch/manual/layouts.html#replace">CWE-93: Improper Neutralization of CRLF Sequences ('CRLF Injection')</a><br/>
    <a href="https://github.com/javabeanz/owasp-security-logging">OWASP Security Logging</a><br/>
</p>


        <p>
         <br/>
         <br/>
      </p>
      <h2>
         <a name="PATH_TRAVERSAL_IN">Potential Path Traversal (file read)</a>
      </h2>
            
<p>A file is opened to read its content. The filename comes from an <b>input</b> parameter.
If an unfiltered parameter is passed to this file API, files from an arbitrary filesystem location could be read.</p>
<p>This rule identifies <b>potential</b> path traversal vulnerabilities. In many cases, the constructed file path cannot be controlled
by the user. If that is the case, the reported instance is a false positive.</p>
<br/>

<p>
    <b>Vulnerable Code:</b><br/>
<pre>@GET
@Path("/images/{image}")
@Produces("images/*")
public Response getImage(@javax.ws.rs.PathParam("image") String image) {
    File file = new File("resources/images/", image); //Weak point

    if (!file.exists()) {
        return Response.status(Status.NOT_FOUND).build();
    }

    return Response.ok().entity(new FileInputStream(file)).build();
}</pre>
</p>
<br/>

<p>
    <b>Solution:</b><br/>
<pre>import org.apache.commons.io.FilenameUtils;

@GET
@Path("/images/{image}")
@Produces("images/*")
public Response getImage(@javax.ws.rs.PathParam("image") String image) {
    File file = new File("resources/images/", FilenameUtils.getName(image)); //Fix

    if (!file.exists()) {
        return Response.status(Status.NOT_FOUND).build();
    }

    return Response.ok().entity(new FileInputStream(file)).build();
}</pre>
</p>
<br/>
<p>
<b>References</b><br/>
<a href="http://projects.webappsec.org/w/page/13246952/Path%20Traversal">WASC: Path Traversal</a><br/>
<a href="https://www.owasp.org/index.php/Path_Traversal">OWASP: Path Traversal</a><br/>
<a href="https://capec.mitre.org/data/definitions/126.html">CAPEC-126: Path Traversal</a><br/>
<a href="https://cwe.mitre.org/data/definitions/22.html">CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal')</a>
</p>

        <p>
         <br/>
         <br/>
      </p>
      <h2>
         <a name="UNENCRYPTED_SERVER_SOCKET">Unencrypted Server Socket</a>
      </h2>
            
<p>
The communication channel used is not encrypted. The traffic could be read by an attacker intercepting the network traffic.
</p>
<p>
<b>Vulnerable Code:</b><br/>
Plain server socket (Cleartext communication):
<pre>ServerSocket soc = new ServerSocket(1234);</pre>
</p>
<p>
<b>Solution:</b><br/>
SSL Server Socket (Secure communication):
<pre>ServerSocket soc = SSLServerSocketFactory.getDefault().createServerSocket(1234);</pre>
</p>
<p>Beyond using an SSL server socket, you need to make sure your use of SSLServerSocketFactory does all the appropriate certificate validation checks to
make sure you are not subject to man-in-the-middle attacks. Please read the OWASP Transport Layer Protection Cheat Sheet for details on how
to do this correctly.
</p>
<br/>
<p>
<b>References</b><br/>
<a href="https://www.owasp.org/index.php/Top_10_2010-A9">OWASP: Top 10 2010-A9-Insufficient Transport Layer Protection</a><br/>
<a href="https://www.owasp.org/index.php/Top_10_2013-A6-Sensitive_Data_Exposure">OWASP: Top 10 2013-A6-Sensitive Data Exposure</a><br/>
<a href="https://www.owasp.org/index.php/Transport_Layer_Protection_Cheat_Sheet">OWASP: Transport Layer Protection Cheat Sheet</a><br/>
<a href="http://projects.webappsec.org/w/page/13246945/Insufficient%20Transport%20Layer%20Protection">WASC-04: Insufficient Transport Layer Protection</a><br/>
<a href="https://cwe.mitre.org/data/definitions/319.html">CWE-319: Cleartext Transmission of Sensitive Information</a>
</p>

        <p>
         <br/>
         <br/>
      </p>
   </body>
</html>
